# ============================================================================
# Firecrawl Monorepo Environment Variables
# ============================================================================
#
# SINGLE SOURCE OF TRUTH: This file contains ALL environment variables for
# ALL services in the monorepo (Firecrawl API, MCP Server, Webhook Bridge).
#
# When deploying via docker-compose, this .env file is automatically loaded
# by all services via the common service anchor.
#
# Individual app .env.example files (apps/mcp/.env.example, etc.) are ONLY
# for standalone deployments and should NOT be used in the monorepo.
#
# Services included:
# - Firecrawl API (Node.js)
# - MCP Server (Node.js)
# - Webhook Bridge (Python)
# - Web Interface (Next.js)
# - Shared Infrastructure (PostgreSQL, Redis, Playwright)
#
# Copy this file to .env and update with your values.
# ============================================================================

# -----------------
# Core Firecrawl API
# -----------------
HOST=0.0.0.0
FIRECRAWL_PORT=50102
FIRECRAWL_INTERNAL_PORT=3002
FIRECRAWL_API_URL=http://localhost:50102
FIRECRAWL_API_KEY=your-api-key-here

# Worker Configuration
WORKER_PORT=50103
EXTRACT_WORKER_PORT=50106
NUM_WORKERS_PER_QUEUE=6
WORKER_CONCURRENCY=4
SCRAPE_CONCURRENCY=6
RETRY_DELAY=3000
MAX_RETRIES=1

# System Resources
MAX_CPU=1.0
MAX_RAM=1.0

# -----------------
# Shared Infrastructure
# -----------------

# PostgreSQL
POSTGRES_USER=firecrawl
POSTGRES_PASSWORD=your-secure-password
POSTGRES_DB=firecrawl_db
POSTGRES_PORT=50105
NUQ_DATABASE_URL=postgres://${POSTGRES_USER}:${POSTGRES_PASSWORD}@firecrawl_db:5432/${POSTGRES_DB}

# Redis
REDIS_PORT=50104
REDIS_URL=redis://firecrawl_cache:6379
REDIS_RATE_LIMIT_URL=redis://firecrawl_cache:6379
BULL_AUTH_KEY=@

# Playwright
PLAYWRIGHT_PORT=50100
PLAYWRIGHT_MICROSERVICE_URL=http://firecrawl_playwright:3000/scrape
BLOCK_MEDIA=true

# -----------------
# MCP Server
# -----------------
# Port Configuration
MCP_PORT=50107

# Firecrawl Integration
MCP_FIRECRAWL_API_KEY=self-hosted-no-auth
MCP_FIRECRAWL_BASE_URL=http://firecrawl:3002

# LLM Provider Configuration (for extract feature)
MCP_LLM_PROVIDER=openai-compatible
MCP_LLM_API_BASE_URL=https://cli-api.tootie.tv/v1
MCP_LLM_MODEL=claude-haiku-4-5-20251001

# MCP Configuration
MCP_OPTIMIZE_FOR=cost
MCP_RESOURCE_STORAGE=memory
MCP_RESOURCE_TTL=86400
DEBUG=false

# Map Tool Configuration
MCP_MAP_DEFAULT_COUNTRY=US
MCP_MAP_DEFAULT_LANGUAGES=en-US
MCP_MAP_MAX_RESULTS_PER_PAGE=200

# -----------------
# Webhook Bridge (Search)
# -----------------
# Note: WEBHOOK_* variables are preferred. SEARCH_BRIDGE_* variables are still supported for backward compatibility.

# Server Configuration
WEBHOOK_HOST=0.0.0.0
WEBHOOK_PORT=50108
WEBHOOK_API_SECRET=your-webhook-api-secret
WEBHOOK_SECRET=your-webhook-hmac-secret
WEBHOOK_CORS_ORIGINS=http://localhost:3000

# Redis Configuration
WEBHOOK_REDIS_URL=redis://firecrawl_cache:6379

# PostgreSQL Configuration
WEBHOOK_DATABASE_URL=postgresql+asyncpg://${POSTGRES_USER}:${POSTGRES_PASSWORD}@firecrawl_db:5432/${POSTGRES_DB}

# Vector Store (Qdrant)
WEBHOOK_QDRANT_URL=http://qdrant:6333
WEBHOOK_QDRANT_COLLECTION=firecrawl_docs
WEBHOOK_VECTOR_DIM=1024

# Embeddings (TEI)
WEBHOOK_TEI_URL=http://tei:80
WEBHOOK_EMBEDDING_MODEL=Qwen/Qwen3-Embedding-0.6B

# Chunking Configuration
WEBHOOK_MAX_CHUNK_TOKENS=256
WEBHOOK_CHUNK_OVERLAP_TOKENS=50

# Search Configuration
WEBHOOK_HYBRID_ALPHA=0.5
WEBHOOK_BM25_K1=1.5
WEBHOOK_BM25_B=0.75
WEBHOOK_RRF_K=60

# Logging
WEBHOOK_LOG_LEVEL=INFO

# Worker Configuration
# Enable background worker thread for processing indexing jobs (default: true)
# Set to false to disable worker (useful for development/testing API only)
WEBHOOK_ENABLE_WORKER=true

# -----------------
# Search Index Integration
# -----------------
# Enable automatic indexing of crawled pages to webhook bridge
ENABLE_SEARCH_INDEX=true

# Search service endpoint (external URL for API access)
SEARCH_SERVICE_URL=http://localhost:50108

# API secret for search endpoints (not used for webhooks)
SEARCH_SERVICE_API_SECRET=your-webhook-api-secret

# Sampling rate for indexing (0.0-1.0, where 1.0 = 100% of pages)
SEARCH_INDEX_SAMPLE_RATE=1.0

# Webhook Configuration
# IMPORTANT: Use internal Docker network URL for webhook delivery
# Format: http://<container-name>:<port>/api/webhook/firecrawl
# ❌ DON'T: https://external-domain.com/... (causes 502 errors)
# ✅ DO: http://firecrawl_webhook:52100/api/webhook/firecrawl
SELF_HOSTED_WEBHOOK_URL=http://localhost:50108/api/webhook/firecrawl

# HMAC secret for webhook signature verification (min 16 chars, must match WEBHOOK_SECRET)
SELF_HOSTED_WEBHOOK_HMAC_SECRET=your-webhook-hmac-secret

# Allow webhooks to internal Docker network addresses (bypasses SSRF protection)
# Required for internal Docker communication, safe for trusted networks
ALLOW_LOCAL_WEBHOOKS=true

# -----------------
# Search Provider
# -----------------
SEARXNG_ENDPOINT=https://s.tootie.tv
SEARXNG_ENGINES=google,bing,duckduckgo,startpage,yandex
SEARXNG_CATEGORIES=general,images,videos,news,map,music,science

# -----------------
# LLM Configuration (Shared)
# -----------------
# OpenAI API (or compatible)
OPENAI_API_KEY=dummy
OPENAI_BASE_URL=https://cli-api.tootie.tv/v1
MODEL_NAME=claude-haiku-4-5-20251001

# Anthropic API
ANTHROPIC_API_KEY=your-anthropic-key

# -----------------
# Application Settings
# -----------------
USE_DB_AUTHENTICATION=false

# Logging levels: ERROR, WARN, INFO, DEBUG
# INFO = General information (recommended for production)
# DEBUG = Verbose debugging (use when troubleshooting webhooks)
LOGGING_LEVEL=INFO
